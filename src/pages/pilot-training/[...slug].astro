---
import { type CollectionEntry, getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

import {
  COMPANY_NAME,
  SITE_DESCRIPTION,
  COMPANY_NAME_CAPS,
  COMPANY_NICKNAME,
  PHONE_NUMBER,
  ADDRESS_LINE_1,
  ADDRESS_LINE_2,
  EMAIL_ADDRESS,
} from "../../consts";
import CTAColor from "../../components/CTAColor.astro";
import HeaderScreen from "../../components/HeaderScreen.astro";
import ProgramSwiper from "../../components/ProgramSwiper.astro";
import TrainingRoadmap from "../../components/TrainingRoadmap.astro";
import Roadmap from "../../data/roadmap-to-commercial-pilot";
import programsSwiper from "../../data/programs";
import flyWithUsCTA from "../../data/CTAFlight.js";

export async function getStaticPaths() {
  const locations = await getCollection("pilot-training");

  return locations.map((entry) => {
    const city = entry.data.city;
    const state = entry.data.stateShort;
    const customSlug = `${city}-${state}`.toLowerCase().replace(/\s+/g, "-");

    return {
      params: { slug: customSlug },
      props: entry, // still pass full entry data
    };
  });
}
type Props = CollectionEntry<"pilot-training">;
const location = Astro.props as Props;
const locationCity = location.data.city || "your area";
const locationStateShort = location.data.stateShort || "your state";
const locationStateLong = location.data.stateLong || "your state";
const locationDescription =
  location.data.description ||
  "A great place with unique attractions and a welcoming community.";
const locationCounty =
  location.data.baseLocation ||
  "A well-known county with rich history and local charm.";
const locationKeyPlace1 =
  location.data.keyPlace1 || "A popular landmark worth visiting.";
const locationKeyPlace2 =
  location.data.keyPlace2 || "Another must-see location in the area.";

function randomItem(arr: string[]) {
  return arr[Math.floor(Math.random() * arr.length)];
}

const headerImage = randomItem(location.data.headerImages || []);
const rawHeadline = randomItem(location.data.headlines || []);
const headerH1 = rawHeadline
  .replace("{{city}}", locationCity)
  .replace("{{stateShort}}", locationStateShort)
  .replace("{{baseLocation}}", locationCounty);

const data = {
  //SEO Header Stuff
  pageTitle: `${locationCity}, ${locationStateLong} Flight School for Pilot Training | ${COMPANY_NAME}`,
  pageDescription: `Explore the top flight school near you, we're based near ${locationCity}, ${locationStateShort}. ${SITE_DESCRIPTION}`,
  pageKeywords: `flight school ${locationCity} ${locationStateLong}, flight school ${locationCity} ${locationStateShort}, Private Pilot ${locationCity} ${locationStateLong}, Instrument Rating  ${locationCity} ${locationStateLong}, Commercial Pilot ${locationCity} ${locationStateLong}, Multi-Engine rating ${locationCity} ${locationStateLong}, Certified Flight Instructor ${locationCity} ${locationStateLong}, Sport Pilot ${locationCity} ${locationStateLong}, bachelor's in professional flight ${locationCity} ${locationStateLong}, bachelor's in aviation management ${locationCity} ${locationStateLong}, aircraft maintenance ${locationCity} ${locationStateLong}, discovery flight ${locationCity} ${locationStateLong}, intro flight ${locationCity} ${locationStateLong}, accelerated pilot training  ${locationCity} ${locationStateLong}, part time pilot training ${locationCity} ${locationStateLong}, ${COMPANY_NAME}, located at ${ADDRESS_LINE_1} ${ADDRESS_LINE_2}, ${PHONE_NUMBER}, ${COMPANY_NAME_CAPS}, ${COMPANY_NICKNAME}, ${EMAIL_ADDRESS}, how to become a pilot, flight school near, private pilot, discovery flight, introductory flight, instrument rating, commercial certificate, certified flight instructor, airline programs, how to become an airline pilot, flight school, pilot training, ${locationCity} flight school, personalized flight training, flexible flight programs, Private Pilot License training, Certified Flight Instructor (CFI) ${locationCity}, multi-engine training ${locationCity}, aviation school in ${locationStateLong}, Cessna 172 training, discovery flights ${locationCity}, pilot school near me, flight training with high pass rate, ${locationKeyPlace1}, ${locationKeyPlace2}, ${locationCounty}`,

  //top header
  header: {
    stars: true,
    imagePath: headerImage || "/src/assets/placeholder.webp",
    imageAlt: `Flight school aircraft at ${locationCity}, ${locationStateShort}`,
    headerH1:
      headerH1 ||
      `Train to become a pilot near ${locationCity}, ${locationStateShort}`,
    paragraph: `USATS offers personalized pilot training in ${locationCity}, located in scenic ${locationStateLong}. ${locationDescription}`,
    buttons: [
      {
        name: "Enroll Today",
        link: "/enroll-now",
        primary: false,
      },
      {
        name: "Discovery Flight",
        link: "/discovery-flight",
        primary: false,
      },
    ],
  },
};
---

<BaseLayout
  siteTitle={data.pageTitle}
  siteDescription={data.pageDescription}
  keywords={data.pageKeywords}
>
  <!-- HEADER -->
  <HeaderScreen content={data.header} />

  <TrainingRoadmap content={Roadmap} />

  <ProgramSwiper content={programsSwiper} />
  <CTAColor content={flyWithUsCTA} />
  <script src="../../scripts/creativeSwiper.js"></script>
</BaseLayout>
